<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receptionist Dashboard - DCAM Therapy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .dashboard-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0;
        }
        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .appointment-card {
            border-left: 4px solid #007bff;
            transition: all 0.3s ease;
        }
        .appointment-card:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-confirmed { background: #d1edff; color: #004085; }
        .status-completed { background: #d4edda; color: #155724; }
        .status-cancelled { background: #f8d7da; color: #721c24; }
        .notification-item {
            border-left: 3px solid #007bff;
            transition: all 0.3s ease;
        }
        .notification-item.unread {
            background-color: #f8f9fa;
            border-left-color: #dc3545;
        }
        .notification-item:hover {
            background-color: #e9ecef;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/receptionist-dashboard">
                <i class="fas fa-hand-holding-heart"></i> DCAM Therapy Center
            </a>
            <div class="navbar-nav ms-auto">
                <!-- Notification Dropdown -->
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle position-relative" href="#" id="notificationDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-bell"></i>
                        <span id="notificationCount" class="notification-badge">0</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-end p-0" style="width: 350px;" id="notificationDropdownMenu">
                        <div class="dropdown-header bg-primary text-white">
                            <strong>Notifications</strong>
                        </div>
                        <div id="notificationList" style="max-height: 400px; overflow-y: auto;">
                            <div class="text-center p-3">
                                <div class="spinner-border spinner-border-sm" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <span class="ms-2">Loading notifications...</span>
                            </div>
                        </div>
                        <div class="dropdown-footer text-center p-2 border-top">
                            <button class="btn btn-sm btn-outline-primary" onclick="markAllNotificationsRead()">
                                Mark All as Read
                            </button>
                        </div>
                    </div>
                </div>
                
                <span class="navbar-text me-3">
                    Welcome, {{ user.first_name }} {{ user.last_name }}
                </span>
                <a class="nav-link" href="/logout">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h2>Receptionist Dashboard</h2>
        
        <!-- Stats Cards -->
        <div class="row mt-4">
            <div class="col-md-3">
                <div class="dashboard-card">
                    <div class="stat-number" id="todaysAppointments">0</div>
                    <div class="stat-label">Today's Appointments</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="dashboard-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <div class="stat-number" id="pendingAppointments">0</div>
                    <div class="stat-label">Pending Appointments</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="dashboard-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <div class="stat-number" id="totalPatients">0</div>
                    <div class="stat-label">Total Patients</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="dashboard-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                    <div class="stat-number" id="totalDoctors">0</div>
                    <div class="stat-label">Total Doctors</div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">Quick Actions</h5>
                        <button class="btn btn-sm btn-outline-primary" onclick="loadAppointments()">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <button class="btn btn-primary w-100" onclick="showAppointmentManagement()">
                                    <i class="fas fa-calendar-alt"></i> Manage Appointments
                                </button>
                            </div>
                            <div class="col-md-3 mb-3">
                                <button class="btn btn-success w-100" onclick="showPatientRegistration()">
                                    <i class="fas fa-user-plus"></i> Register Patient
                                </button>
                            </div>
                            <div class="col-md-3 mb-3">
                                <button class="btn btn-info w-100" onclick="showPatientList()">
                                    <i class="fas fa-users"></i> View Patients
                                </button>
                            </div>
                            <div class="col-md-3 mb-3">
                                <button class="btn btn-warning w-100" onclick="showReports()">
                                    <i class="fas fa-chart-bar"></i> Reports
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Appointments -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">Recent Appointment Requests</h5>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-outline-secondary" onclick="filterAppointments('all')">All</button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="filterAppointments('pending')">Pending</button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="filterAppointments('today')">Today</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="appointmentsList">
                            <div class="text-center py-4">
                                <div class="spinner-border" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2">Loading appointments...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Appointment Management Modal -->
    <div class="modal fade" id="appointmentManagementModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Appointment Management</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="appointmentManagementContent">
                        Loading appointments...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Patient List Modal -->
    <div class="modal fade" id="patientListModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Patient List</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="patientListContent">
                        Loading patients...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Appointment Action Modal -->
    <div class="modal fade" id="appointmentActionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="actionModalTitle">Appointment Action</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="actionModalBody">
                    <!-- Content will be loaded dynamically -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmActionBtn">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentAppointmentId = null;
        let currentAction = null;

        // Load dashboard data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardStats();
            loadAppointments();
            loadNotifications();
            
            // Auto-refresh every 30 seconds
            setInterval(loadNotifications, 30000);
            setInterval(loadAppointments, 60000);
        });

        function loadDashboardStats() {
            fetch('/api/dashboard-stats')
                .then(response => response.json())
                .then(stats => {
                    document.getElementById('todaysAppointments').textContent = stats.todays_appointments || 0;
                    document.getElementById('pendingAppointments').textContent = stats.pending_registrations || 0;
                    document.getElementById('totalPatients').textContent = stats.total_patients || 0;
                    document.getElementById('totalDoctors').textContent = stats.total_doctors || 0;
                })
                .catch(error => {
                    console.error('Error loading dashboard stats:', error);
                    // Set demo data
                    document.getElementById('todaysAppointments').textContent = '5';
                    document.getElementById('pendingAppointments').textContent = '3';
                    document.getElementById('totalPatients').textContent = '45';
                    document.getElementById('totalDoctors').textContent = '11';
                });
        }

        // function loadAppointments() {
        //     fetch('/api/receptionist/appointments?status=pending')
        //         .then(response => response.json())
        //         .then(data => {
        //             renderAppointments(data.appointments || []);
        //             updateAppointmentStats(data.stats || {});
        //         })
        //         .catch(error => {
        //             console.error('Error loading appointments:', error);
        //             // Demo data
        //             const demoAppointments = [
        //                 {
        //                     appointment_id: 'APT001',
        //                     patient_name: 'Rahul Kumar',
        //                     patient_email: 'rahul@example.com',
        //                     patient_phone: '+91-9876543210',
        //                     therapy_type: 'acupressure',
        //                     therapy_name: 'Acupressure',
        //                     doctor_name: 'Dr. Rajesh Sharma',
        //                     date: new Date(Date.now() + 86400000).toISOString(),
        //                     reason: 'Chronic back pain',
        //                     status: 'pending',
        //                     consultation_type: 'initial'
        //                 },
        //                 {
        //                     appointment_id: 'APT002',
        //                     patient_name: 'Priya Singh',
        //                     patient_email: 'priya@example.com',
        //                     patient_phone: '+91-9876543211',
        //                     therapy_type: 'ayurveda',
        //                     therapy_name: 'Ayurveda',
        //                     doctor_name: 'Dr. Priya Gupta',
        //                     date: new Date(Date.now() + 172800000).toISOString(),
        //                     reason: 'Digestive issues',
        //                     status: 'pending',
        //                     consultation_type: 'follow-up'
        //                 }
        //             ];
        //             renderAppointments(demoAppointments);
        //         });
        // }
       


        // function renderAppointments(appointments) {
        //     const container = document.getElementById('appointmentsList');
            
        //     if (appointments.length === 0) {
        //         container.innerHTML = `
        //             <div class="text-center py-4">
        //                 <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
        //                 <p class="text-muted">No appointment requests found</p>
        //             </div>
        //         `;
        //         return;
        //     }

        //     container.innerHTML = appointments.map(appt => {
        //         const date = new Date(appt.date);
        //         const dateString = date.toLocaleDateString();
        //         const timeString = date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
        //         const statusClass = {
        //             'pending': 'status-pending',
        //             'confirmed': 'status-confirmed',
        //             'completed': 'status-completed',
        //             'cancelled': 'status-cancelled'
        //         }[appt.status] || 'status-pending';
                
        //         return `
        //             <div class="card appointment-card mb-3">
        //                 <div class="card-body">
        //                     <div class="row">
        //                         <div class="col-md-8">
        //                             <h6 class="card-title">${appt.patient_name}</h6>
        //                             <p class="card-text mb-1">
        //                                 <strong>Therapy:</strong> ${appt.therapy_name} 
        //                                 <strong>Doctor:</strong> ${appt.doctor_name}
        //                             </p>
        //                             <p class="card-text mb-1">
        //                                 <strong>Date:</strong> ${dateString} at ${timeString}
        //                             </p>
        //                             <p class="card-text mb-1">
        //                                 <strong>Reason:</strong> ${appt.reason}
        //                             </p>
        //                             <p class="card-text">
        //                                 <strong>Contact:</strong> ${appt.patient_phone} | ${appt.patient_email}
        //                             </p>
        //                         </div>
        //                         <div class="col-md-4 text-end">
        //                             <span class="status-badge ${statusClass}">${appt.status}</span>
        //                             <div class="mt-3">
        //                                 <button class="btn btn-sm btn-success" onclick="confirmAppointment('${appt.appointment_id}')">
        //                                     <i class="fas fa-check"></i> Confirm
        //                                 </button>
        //                                 <button class="btn btn-sm btn-warning" onclick="rescheduleAppointment('${appt.appointment_id}')">
        //                                     <i class="fas fa-clock"></i> Reschedule
        //                                 </button>
        //                                 <button class="btn btn-sm btn-danger" onclick="cancelAppointment('${appt.appointment_id}')">
        //                                     <i class="fas fa-times"></i> Cancel
        //                                 </button>
        //                             </div>
        //                         </div>
        //                     </div>
        //                 </div>
        //             </div>
        //         `;
        //     }).join('');
        // }
        function loadAppointments() {
    fetch('/api/receptionist/appointments?status=pending')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            renderAppointments(data.appointments || []);
            updateAppointmentStats(data.stats || {});
        })
        .catch(error => {
            console.error('Error loading appointments:', error);
            // Show empty state instead of demo data
            renderAppointments([]);
        });
}

function renderAppointments(appointments) {
    const container = document.getElementById('appointmentsList');
    
    if (appointments.length === 0) {
        container.innerHTML = `
            <div class="text-center py-4">
                <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                <p class="text-muted">No appointment requests found</p>
                <small class="text-muted">When patients book appointments, they will appear here.</small>
            </div>
        `;
        return;
    }

    container.innerHTML = appointments.map(appt => {
        const date = new Date(appt.date);
        const dateString = date.toLocaleDateString();
        const timeString = date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        
        const statusClass = {
            'pending': 'status-pending',
            'confirmed': 'status-confirmed',
            'completed': 'status-completed',
            'cancelled': 'status-cancelled'
        }[appt.status] || 'status-pending';
        
        return `
            <div class="card appointment-card mb-3">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h6 class="card-title">${appt.patient_name}</h6>
                            <p class="card-text mb-1">
                                <strong>Therapy:</strong> ${appt.therapy_name} 
                                <strong>Doctor:</strong> ${appt.doctor_name}
                            </p>
                            <p class="card-text mb-1">
                                <strong>Date:</strong> ${dateString} at ${timeString}
                            </p>
                            <p class="card-text mb-1">
                                <strong>Reason:</strong> ${appt.reason}
                            </p>
                            <p class="card-text">
                                <strong>Contact:</strong> ${appt.patient_phone} | ${appt.patient_email}
                            </p>
                        </div>
                        <div class="col-md-4 text-end">
                            <span class="status-badge ${statusClass}">${appt.status}</span>
                            <div class="mt-3">
                                <button class="btn btn-sm btn-success" onclick="confirmAppointment('${appt.appointment_id}')">
                                    <i class="fas fa-check"></i> Confirm
                                </button>
                                <button class="btn btn-sm btn-warning" onclick="rescheduleAppointment('${appt.appointment_id}')">
                                    <i class="fas fa-clock"></i> Reschedule
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="cancelAppointment('${appt.appointment_id}')">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }).join('');
}
        function loadNotifications() {
            fetch('/api/receptionist/notifications')
                .then(response => response.json())
                .then(notifications => {
                    updateNotificationUI(notifications);
                })
                .catch(error => {
                    console.error('Error loading notifications:', error);
                    // Demo notifications
                    const demoNotifications = [
                        {
                            title: 'New Appointment Request',
                            message: 'Rahul Kumar requested Acupressure therapy',
                            type: 'info',
                            is_read: false,
                            created_at: new Date().toISOString()
                        },
                        {
                            title: 'Appointment Reminder',
                            message: 'Priya Singh has appointment in 30 minutes',
                            type: 'warning',
                            is_read: true,
                            created_at: new Date(Date.now() - 1800000).toISOString()
                        }
                    ];
                    updateNotificationUI(demoNotifications);
                });
        }

        function updateNotificationUI(notifications) {
            const unreadCount = notifications.filter(n => !n.is_read).length;
            const notificationCount = document.getElementById('notificationCount');
            const notificationList = document.getElementById('notificationList');

            notificationCount.textContent = unreadCount;
            notificationCount.style.display = unreadCount > 0 ? 'flex' : 'none';

            if (notifications.length === 0) {
                notificationList.innerHTML = '<div class="p-3 text-center text-muted">No notifications</div>';
            } else {
                notificationList.innerHTML = notifications.map(notification => `
                    <div class="dropdown-item notification-item ${!notification.is_read ? 'unread' : ''}">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">${notification.title}</h6>
                            <small>${formatTime(notification.created_at)}</small>
                        </div>
                        <p class="mb-1">${notification.message}</p>
                        ${!notification.is_read ? '<small class="text-primary">New</small>' : ''}
                    </div>
                `).join('');
            }
        }

        function formatTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return date.toLocaleDateString();
        }

        function markAllNotificationsRead() {
            fetch('/api/notifications/read', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    loadNotifications();
                }
            })
            .catch(error => {
                console.error('Error marking notifications as read:', error);
            });
        }

        // Appointment Actions
        function confirmAppointment(appointmentId) {
            currentAppointmentId = appointmentId;
            currentAction = 'confirm';
            
            document.getElementById('actionModalTitle').textContent = 'Confirm Appointment';
            document.getElementById('actionModalBody').innerHTML = `
                <p>Are you sure you want to confirm this appointment?</p>
                <div class="mb-3">
                    <label for="scheduledTime" class="form-label">Schedule Time (Optional)</label>
                    <input type="time" class="form-control" id="scheduledTime">
                </div>
                <p class="text-muted">This will notify both the patient and doctor about the confirmed appointment.</p>
            `;
            document.getElementById('confirmActionBtn').className = 'btn btn-success';
            document.getElementById('confirmActionBtn').textContent = 'Confirm Appointment';
            
            new bootstrap.Modal(document.getElementById('appointmentActionModal')).show();
        }

        function rescheduleAppointment(appointmentId) {
            currentAppointmentId = appointmentId;
            currentAction = 'reschedule';
            
            document.getElementById('actionModalTitle').textContent = 'Reschedule Appointment';
            document.getElementById('actionModalBody').innerHTML = `
                <p>Reschedule this appointment:</p>
                <div class="mb-3">
                    <label for="newDate" class="form-label">New Date</label>
                    <input type="date" class="form-control" id="newDate" required>
                </div>
                <div class="mb-3">
                    <label for="newTime" class="form-label">New Time</label>
                    <input type="time" class="form-control" id="newTime" required>
                </div>
            `;
            document.getElementById('confirmActionBtn').className = 'btn btn-warning';
            document.getElementById('confirmActionBtn').textContent = 'Reschedule';
            
            new bootstrap.Modal(document.getElementById('appointmentActionModal')).show();
        }

        function cancelAppointment(appointmentId) {
            currentAppointmentId = appointmentId;
            currentAction = 'cancel';
            
            document.getElementById('actionModalTitle').textContent = 'Cancel Appointment';
            document.getElementById('actionModalBody').innerHTML = `
                <p>Are you sure you want to cancel this appointment?</p>
                <div class="mb-3">
                    <label for="cancelReason" class="form-label">Reason for Cancellation (Optional)</label>
                    <textarea class="form-control" id="cancelReason" rows="3"></textarea>
                </div>
                <p class="text-danger">This action cannot be undone.</p>
            `;
            document.getElementById('confirmActionBtn').className = 'btn btn-danger';
            document.getElementById('confirmActionBtn').textContent = 'Cancel Appointment';
            
            new bootstrap.Modal(document.getElementById('appointmentActionModal')).show();
        }

        // Handle confirmation of actions
        // document.getElementById('confirmActionBtn').addEventListener('click', function() {
        //     if (!currentAppointmentId) return;

        //     let url = '';
        //     let method = 'POST';
        //     let body = {};

        //     switch (currentAction) {
        //         case 'confirm':
        //             url = `/api/receptionist/appointments/${currentAppointmentId}/confirm`;
        //             const scheduledTime = document.getElementById('scheduledTime').value;
        //             if (scheduledTime) {
        //                 body = { scheduled_time: scheduledTime };
        //             }
        //             break;
        //         case 'reschedule':
        //             url = `/api/receptionist/appointments/${currentAppointmentId}/reschedule`;
        //             const newDate = document.getElementById('newDate').value;
        //             const newTime = document.getElementById('newTime').value;
        //             if (!newDate || !newTime) {
        //                 alert('Please provide both date and time');
        //                 return;
        //             }
        //             body = { new_date: `${newDate}T${newTime}:00` };
        //             break;
        //         case 'cancel':
        //             url = `/api/receptionist/appointments/${currentAppointmentId}/cancel`;
        //             const cancelReason = document.getElementById('cancelReason').value;
        //             if (cancelReason) {
        //                 body = { reason: cancelReason };
        //             }
        //             break;
        //     }

        //     fetch(url, {
        //         method: method,
        //         headers: {
        //             'Content-Type': 'application/json'
        //         },
        //         body: Object.keys(body).length ? JSON.stringify(body) : null
        //     })
        //     .then(response => response.json())
        //     .then(data => {
        //         if (data.error) {
        //             alert('Error: ' + data.error);
        //         } else {
        //             alert('✅ ' + data.message);
        //             bootstrap.Modal.getInstance(document.getElementById('appointmentActionModal')).hide();
        //             loadAppointments();
        //             loadNotifications();
        //         }
        //     })
        //     .catch(error => {
        //         console.error('Error performing action:', error);
        //         alert('Failed to perform action');
        //     });
        // });
        // Handle confirmation of actions
document.getElementById('confirmActionBtn').addEventListener('click', function() {
    if (!currentAppointmentId) return;

    let url = '';
    let method = 'POST';
    let body = {};

    switch (currentAction) {
        case 'confirm':
            url = `/api/receptionist/appointments/${currentAppointmentId}/confirm`;
            const scheduledTime = document.getElementById('scheduledTime').value;
            if (scheduledTime) {
                body = { scheduled_time: scheduledTime };
            }
            break;
        case 'reschedule':
            // For now, show message that reschedule is not implemented
            alert('Reschedule feature will be implemented in the next version');
            bootstrap.Modal.getInstance(document.getElementById('appointmentActionModal')).hide();
            return;
        case 'cancel':
            // For now, show message that cancel is not implemented  
            alert('Cancel feature will be implemented in the next version');
            bootstrap.Modal.getInstance(document.getElementById('appointmentActionModal')).hide();
            return;
    }

    fetch(url, {
        method: method,
        headers: {
            'Content-Type': 'application/json'
        },
        body: Object.keys(body).length ? JSON.stringify(body) : null
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        if (data.error) {
            alert('Error: ' + data.error);
        } else {
            alert('✅ ' + data.message);
            bootstrap.Modal.getInstance(document.getElementById('appointmentActionModal')).hide();
            loadAppointments();
            loadNotifications();
        }
    })
    .catch(error => {
        console.error('Error performing action:', error);
        alert('Failed to perform action: ' + error.message);
    });
});
        // Quick Action Functions
        function showAppointmentManagement() {
            fetch('/api/receptionist/appointments')
                .then(response => response.json())
                .then(data => {
                    let content = '';
                    if (data.appointments && data.appointments.length > 0) {
                        content = `
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Appointment ID</th>
                                            <th>Patient</th>
                                            <th>Therapy</th>
                                            <th>Doctor</th>
                                            <th>Date & Time</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${data.appointments.map(appt => {
                                            const date = new Date(appt.date);
                                            const statusClass = {
                                                'pending': 'status-pending',
                                                'confirmed': 'status-confirmed',
                                                'completed': 'status-completed',
                                                'cancelled': 'status-cancelled'
                                            }[appt.status] || 'status-pending';
                                            
                                            return `
                                                <tr>
                                                    <td>${appt.appointment_id}</td>
                                                    <td>${appt.patient_name}</td>
                                                    <td>${appt.therapy_name}</td>
                                                    <td>${appt.doctor_name}</td>
                                                    <td>${date.toLocaleString()}</td>
                                                    <td><span class="status-badge ${statusClass}">${appt.status}</span></td>
                                                    <td>
                                                        <button class="btn btn-sm btn-outline-primary" onclick="viewAppointmentDetails('${appt.appointment_id}')">View</button>
                                                        ${appt.status === 'pending' ? `
                                                            <button class="btn btn-sm btn-success" onclick="confirmAppointment('${appt.appointment_id}')">Confirm</button>
                                                        ` : ''}
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        `;
                    } else {
                        content = '<p class="text-center">No appointments found.</p>';
                    }
                    document.getElementById('appointmentManagementContent').innerHTML = content;
                    new bootstrap.Modal(document.getElementById('appointmentManagementModal')).show();
                })
                .catch(error => {
                    console.error('Error loading appointments:', error);
                    document.getElementById('appointmentManagementContent').innerHTML = '<p>Error loading appointments.</p>';
                    new bootstrap.Modal(document.getElementById('appointmentManagementModal')).show();
                });
        }

        function showPatientRegistration() {
            alert('Patient registration feature will be implemented here');
            // You can redirect to a registration page or show a modal
            // window.location.href = '/patient-registration';
        }

        function showPatientList() {
            fetch('/api/receptionist/patients')
                .then(response => response.json())
                .then(patients => {
                    let content = '';
                    if (patients.length > 0) {
                        content = `
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Patient ID</th>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Phone</th>
                                            <th>Registration Date</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${patients.map(patient => {
                                            const createdDate = new Date(patient.created_at);
                                            return `
                                                <tr>
                                                    <td>${patient.user_id}</td>
                                                    <td>${patient.first_name} ${patient.last_name}</td>
                                                    <td>${patient.email}</td>
                                                    <td>${patient.phone || 'N/A'}</td>
                                                    <td>${createdDate.toLocaleDateString()}</td>
                                                    <td>
                                                        <button class="btn btn-sm btn-info" onclick="viewPatientDetails('${patient.user_id}')">View</button>
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        `;
                    } else {
                        content = '<p>No patients found.</p>';
                    }
                    document.getElementById('patientListContent').innerHTML = content;
                    new bootstrap.Modal(document.getElementById('patientListModal')).show();
                })
                .catch(error => {
                    console.error('Error fetching patients:', error);
                    document.getElementById('patientListContent').innerHTML = '<p>Error loading patients.</p>';
                    new bootstrap.Modal(document.getElementById('patientListModal')).show();
                });
        }

        function showReports() {
            alert('Reports feature will be implemented here');
            // You can redirect to a reports page or show a modal with charts
        }

        function viewAppointmentDetails(appointmentId) {
            alert('Viewing details for appointment: ' + appointmentId);
            // Implement appointment details view
        }

        function viewPatientDetails(patientId) {
            alert('Viewing details for patient: ' + patientId);
            // Implement patient details view
        }

        function filterAppointments(filter) {
            // Implement filtering logic
            alert('Filtering appointments by: ' + filter);
        }

        function updateAppointmentStats(stats) {
            // Update any additional stats if needed
            console.log('Appointment stats updated:', stats);
        }
    </script>
</body>
</html>